Bataille navale Web - Decisions du projet
=========================================

1. Stack technique : JS vanilla (ES6+), CSS pur, pas de framework
2. Architecture : client-serveur (Node.js backend optionnel pour multijoueur)
3. Esthetique : Frutiger Aero (glossy, reflets, degrades, ombres douces)
4. Grille : 4x4 par defaut (comme Java), taille configurable
5. Bateaux : CSS pur avec border-radius, box-shadow, linear-gradient
6. Animations : CSS @keyframes pour tirs (splash eau, explosion touche, naufrage coule)
7. IA : port direct de IA_procedurale.java (mode RECHERCHE diagonale + PONCAGE)
8. Structure : index.html, style.css, app.js (point entree), modules/ pour classes
9. Sans assets externes : tout en CSS (formes, icones, effets)
10. Section 36 respectee : fonctions <=15 lignes, nommage explicite, sections commentees
11. Port détemrin en varbale sglobal en hau du ficheir; por hcoisi -> 4511, pas de .env
12. ajoute run dectio du oport occupé et un lmesge de ce type (emoji crois) Le port $port est déjà occurpé. puis exuctio en system (1)
14. (emoji fusée )Server lancé sur le port $port lors que lseveur se lance
___

Choix techniques :


Architecture fichiers
---------------------
1.5 WEB/
├── server.js           # Serveur Node.js (point d'entree backend)
├── Makefile            # Commandes : make run, make dev
├── assets/
│   └── index/
│       ├── index.html  # Page principale
│       ├── style.css   # Styles Frutiger Aero
│       └── app.js      # Logique frontend (point d'entree)
└── Reflexion/
    └── Reflexion_creation_projet_web.txt


Classes JS (port du Java)
-------------------------
- Grille : dimensions (hauteur, largeur)
- Case : coordonnees (ordonnee, abscisse), etat (attaquee, coulee)
- Bateau : tableau de cases, etat (touche, coule)
- Joueur : plateau, bateaux, cases_tentees, IA_humain
- IA_procedurale : mode (RECHERCHE/PONCAGE), direction, cases_touchees


Etats d'une case (affichage)
----------------------------
- -1 : non tentee (vide)
-  0 : eau (tir rate)
-  1 : touche (tir reussi)
-  2 : coule (bateau entierement detruit)


Animations CSS prevues
----------------------
- Tir dans l'eau : cercles concentriques (ripple effect)
- Tir touche : flash rouge + secousse
- Bateau coule : rotation + descente + fade out


Style Frutiger Aero
-------------------
- Fond : degrade bleu ciel vers blanc
- Grille : effet verre (glassmorphism), bordures arrondies
- Cases : ombres douces, reflets subtils
- Bateaux : degrade metallique, ombre portee
- Boutons : effet 3D, hover avec brillance

___

Taches restantes
----------------

1. Bug 404 : le serveur ne trouve pas les fichiers
   - Verifier le chemin assets/ dans server.js
   - Ajouter des logs sur chaque requete (URL demandee, chemin resolu, existe ou non)

2. Choix du nombre de cases (taille grille)
   - Ajouter un menu/formulaire avant le jeu
   - Inputs : hauteur et largeur (min 4, max 10)
   - Bouton "Commencer" qui lance la partie avec ces dimensions

3. Placement des bateaux par le joueur
   - Phase de placement avant le jeu
   - Clic sur case de depart + clic sur case de fin
   - Validation : alignement horizontal ou vertical, pas de chevauchement
   - Affichage visuel des bateaux places (classe CSS case--bateau)
   - Bouton "Valider placement" quand tous les bateaux sont places

4. IA procedurale (port de IA_procedurale.java)
   - Mode RECHERCHE : tir en diagonale (cases ou (ligne + colonne) % 2 == 0)
   - Mode PONCAGE : apres un touche, explorer les 4 directions
   - Transitions : touche -> poncage, coule -> recherche
   - Variables : case_touchee_initiale, direction_actuelle, directions_essayees[]

5. Logs detailles partout
   - server.js : chaque requete (methode, URL, chemin, status)
   - app.js : chaque action (init, clic, tir, resultat, changement etat)

___

Nouvelles taches - 2026-02-27
-----------------------------

6. Taille par defaut = 10 (au lieu de 4)
   - Modifier value="4" en value="10" dans index.html
   - Modifier tailleGrille = 4 en tailleGrille = 10 dans app.js

7. Diminuer la taille des cases
   - Adapter la taille selon le nombre de cases (plus de cases = cases plus petites)
   - Calcul dynamique : largeur disponible / nombre de cases
   - Ne pas diminuer verticalement, seulement horizontalement

8. Disposition grilles : joueur a gauche, adversaire a droite
   - Verifier que le CSS flex place bien les grilles cote a cote
   - Grille joueur en premier dans le HTML = a gauche

9. Switch "Placement automatique" dans le menu configuration
   - Checkbox/switch avec label "Placement automatique"
   - Par defaut : coche (true) = placement aleatoire
   - Si decoche : placement manuel avec preview/ombre du bateau

10. Placement manuel avec ombre/preview
    - Au survol : afficher une ombre du bateau a placer
    - Clic pour placer (pas debut + fin)
    - Touche R ou clic droit pour pivoter (horizontal/vertical)
    - Validation automatique si position valide

___

Problemes constates - 2026-02-27
--------------------------------

1. Disposition grilles : empilees verticalement au lieu de cote a cote
   - Cause probable : CSS flexbox wrap ou largeur insuffisante
   - Solution : verifier .zone-jeu flex-direction et flex-wrap

2. Clics sur mauvaise grille : on peut cliquer sur sa propre flotte
   - Comportement attendu : cliquer uniquement sur grille adverse pour tirer
   - Solution : rendre grille joueur non cliquable apres phase placement

3. Nombre de bateaux insuffisant : seulement 2-3 bateaux
   - Regles officielles : 5 bateaux
   - Solution : adapter bateauxAplacer selon regles

___

Regles officielles Bataille Navale (Touche-Coule)
-------------------------------------------------

Source : Wikipedia, regles-de-jeux.com

Grille : 10x10 (lignes 1-10, colonnes A-J)

5 bateaux par joueur :
- Porte-avions : 5 cases
- Croiseur : 4 cases
- Contre-torpilleur : 3 cases
- Sous-marin : 3 cases
- Torpilleur : 2 cases

Total : 17 cases occupees

Placement :
- Horizontal ou vertical uniquement (jamais diagonal)
- Bateaux ne se chevauchent pas
- Variante : bateaux non adjacents (pas cote a cote)

Deroulement :
- Tour par tour
- Annonce coordonnees (ex: A4)
- Reponse : "rate", "touche", ou "touche coule"

Fin : le premier a couler tous les bateaux adverses gagne

___

Adaptation pour grille variable (code Java)
-------------------------------------------

Le code Java (Bateau.java:56-61) calcule :
- Nombre max de cases bateaux = (3/5) * (hauteur * largeur)
- Ex: grille 10x10 = 100 cases -> max 60 cases de bateaux
- Ex: grille 4x4 = 16 cases -> max 9 cases de bateaux

Taille max d'un bateau = min(hauteur, largeur)
- Ex: grille 10x10 -> bateau max 10 cases
- Ex: grille 4x4 -> bateau max 4 cases

Pour grille 10x10 standard : utiliser les 5 bateaux officiels (17 cases)
Pour petites grilles : adapter proportionnellement

___

Corrections a implementer
-------------------------

1. CSS : forcer flex-direction: row sur .zone-jeu + flex-wrap: nowrap

2. JS : rendreGrille("grille-joueur", ..., false) apres placement
   - Grille joueur = non cliquable en phase jeu
   - Grille adversaire = cliquable en phase jeu

3. JS : adapter bateauxAplacer selon taille grille
   - 10x10 : [5, 4, 3, 3, 2] (17 cases - officiel)
   - 8x8 : [4, 3, 3, 2] (12 cases)
   - 6x6 : [3, 3, 2] (8 cases)
   - 4x4 : [2, 2] (4 cases)

___

Analyse code Java IA.java - Placement automatique
-------------------------------------------------

Algorithme de placement (place_bateaux_IA, lignes 157-174) :

1. Calcul nombre cases max = (3/5) * (hauteur * largeur)
   - Grille 10x10 : 60 cases max
   - Grille 4x4 : 9 cases max

2. Calcul nombre de bateaux :
   - Division cases max par min(hauteur, largeur)
   - Ajout 1 si reste non nul

3. Calcul tailles bateaux (pour chaque bateau) :
   - tailleMin = 40% de tailleMax
   - taille = random entre tailleMin et tailleMax
   - Garantit minimum 1 case

4. Placement avec distance de securite :
   - Marque cases adjacentes comme occupees
   - Bateaux ne se touchent jamais

5. Gestion echecs :
   - 5 tentatives par taille
   - Reduction taille si echec
   - Dernier recours : 1 case

Fonction cle : place_un_bateau_aux (lignes 226-246)
- Cherche cases disponibles
- Choisit aleatoirement
- Marque le plateau

Avantage : s'adapte automatiquement a toute taille de grille
Inconvenient : nombre/taille bateaux non conforme aux regles officielles

___

Bugs et fonctionnalites - 2026-02-27 (suite)
--------------------------------------------

11. Bug IA : tire plusieurs fois sur case deja coulee
    - Cause : iaCaseLibre() ne verifie pas ETAT_COULE
    - Solution : ajouter verification ETAT_COULE dans iaCaseLibre()

12. Bug fin de partie : pas de message victoire
    - Cause : verifierFinPartie() pas appelee correctement ou logique incorrecte
    - Solution : verifier la logique de tousCoules() et l'appel apres tir joueur

13. Bug affichage : bateaux ennemis visibles
    - Comportement attendu : bateaux adverses caches jusqu'a ce qu'ils soient touches
    - Solution : ne pas appliquer classe case--bateau sur grille adversaire

14. Option --triche dans server.js
    - But : afficher les bateaux ennemis pour debuggage
    - Implementation : variable globale MODE_TRICHE, passee au frontend via API ou cookie

15. Options -h et --help dans server.js
    - Affiche l'aide avec description des options
    - Format : "Usage: node server.js [options]" puis liste des options

16.

Résumé de l'algorithme des placemnt de bateaux en Java :

- Nombre cases max = 60% de la surface grille
- Tailles aléatoires entre 40% et 100% de min(hauteur, largeur)
- Distance de sécurité entre bateaux (ne se touchent pas)
- Gestion des échecs avec réduction de taille

17.

Proposer un calcul pour adapter le nombre et la taille des bateaux proportionnellement à la taille de la grille, en gardant 10x10 comme référence (règles officielles : 5 bateaux de tailles 5, 4, 3, 3, 2 = 17 cases).

---
Analyse :

Référence 10x10 :
- Surface : 100 cases
- Bateaux : 5, 4, 3, 3, 2 (5 bateaux, 17 cases occupées)
- Ratio occupation : 17%
- Taille moyenne bateau : 3.4 cases
- Taille max : 5 (50% de la dimension grille)

Principes à conserver :
1. Ratio occupation ~17% de la surface
2. Taille max bateau = 50% de la dimension grille
3. Taille min bateau = 2 cases
4. Nombre de bateaux proportionnel à la surface

Calcul proposé :

surface = tailleGrille × tailleGrille
casesOccupees = Math.round(surface × 0.17)
tailleMax = Math.max(2, Math.floor(tailleGrille / 2))
tailleMin = 2

// Nombre de bateaux ≈ casesOccupees / tailleMoyenne
// tailleMoyenne ≈ (tailleMax + tailleMin) / 2
tailleMoyenne = (tailleMax + tailleMin) / 2
nombreBateaux = Math.round(casesOccupees / tailleMoyenne)

// Génération des tailles : distribution décroissante depuis tailleMax

Exemples :

| Grille  | Surface | Cases (17%) | Taille max | Bateaux estimés |
|---------|---------|-------------|------------|-----------------|
| 4×4     | 16      | 3           | 2          | 1-2             |
| 10×10   | 100     | 17          | 5          | 5               |
| 20×20   | 400     | 68          | 10         | 11              |
| 50×50   | 2500    | 425         | 25         | 31              |
| 100×100 | 10000   | 1700        | 50         | 65              |

18.

Afficher un panneau (en bas à gauche, style Frutiger Aero, fond rouge) montrant les bateaux restants à placer :
- "N bateaux restants"
- Détail par taille décroissante : "1 bateau de 5 cases", "2 bateaux de 3 cases", etc.
